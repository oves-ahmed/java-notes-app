<!-- src/main/resources/static/index.html -->
<!-- The interactive frontend for the application, built with React and Tailwind CSS. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Boot Notes App</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [notes, setNotes] = useState([]);
            const [newNote, setNewNote] = useState('');
            const [editingNoteId, setEditingNoteId] = useState(null);
            const [editingNoteContent, setEditingNoteContent] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetchNotes();
            }, []);

            const fetchNotes = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch('/api/notes');
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.json();
                    setNotes(data);
                } catch (error) {
                    setError('Failed to fetch notes. Please check the backend connection.');
                    console.error('Fetch error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleAddNote = async (e) => {
                e.preventDefault();
                if (!newNote.trim()) return;
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch('/api/notes', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content: newNote })
                    });
                    if (!response.ok) {
                        throw new Error('Failed to add note');
                    }
                    setNewNote('');
                    fetchNotes();
                } catch (error) {
                    setError('Failed to add note.');
                    console.error('Add note error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleUpdateNote = async (id) => {
                if (!editingNoteContent.trim()) return;
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`/api/notes/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content: editingNoteContent })
                    });
                    if (!response.ok) {
                        throw new Error('Failed to update note');
                    }
                    setEditingNoteId(null);
                    setEditingNoteContent('');
                    fetchNotes();
                } catch (error) {
                    setError('Failed to update note.');
                    console.error('Update note error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleDeleteNote = async (id) => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`/api/notes/${id}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) {
                        throw new Error('Failed to delete note');
                    }
                    fetchNotes();
                } catch (error) {
                    setError('Failed to delete note.');
                    console.error('Delete note error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const startEditing = (note) => {
                setEditingNoteId(note.id);
                setEditingNoteContent(note.content);
            };

            return (
                <div className="container mx-auto p-8 max-w-2xl bg-white shadow-xl rounded-2xl">
                    <h1 className="text-4xl font-bold text-gray-800 mb-6 text-center">My Notes üìù</h1>
                    
                    {error && (
                        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md" role="alert">
                            <p className="font-bold">Error</p>
                            <p>{error}</p>
                        </div>
                    )}

                    <form onSubmit={handleAddNote} className="mb-8">
                        <div className="flex flex-col sm:flex-row gap-4">
                            <input
                                type="text"
                                className="flex-grow p-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                                placeholder="Write a new note..."
                                value={newNote}
                                onChange={(e) => setNewNote(e.target.value)}
                                disabled={loading}
                            />
                            <button
                                type="submit"
                                className="bg-blue-600 text-white font-medium py-3 px-6 rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled={loading}
                            >
                                Add Note
                            </button>
                        </div>
                    </form>

                    {loading && (
                        <div className="flex justify-center items-center h-20">
                            <div className="w-8 h-8 border-4 border-dashed rounded-full animate-spin border-blue-500"></div>
                            <span className="ml-4 text-gray-600">Loading...</span>
                        </div>
                    )}
                    
                    <ul className="space-y-4">
                        {notes.length > 0 ? notes.map(note => (
                            <li key={note.id} className="bg-gray-50 p-6 rounded-xl shadow-sm flex flex-col md:flex-row items-start md:items-center justify-between">
                                {editingNoteId === note.id ? (
                                    <div className="flex-grow flex flex-col sm:flex-row items-center gap-4 w-full">
                                        <input
                                            type="text"
                                            className="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                            value={editingNoteContent}
                                            onChange={(e) => setEditingNoteContent(e.target.value)}
                                        />
                                        <div className="flex gap-2 mt-2 sm:mt-0">
                                            <button
                                                onClick={() => handleUpdateNote(note.id)}
                                                className="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                disabled={loading}
                                            >
                                                Save
                                            </button>
                                            <button
                                                onClick={() => setEditingNoteId(null)}
                                                className="bg-gray-400 text-white py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                disabled={loading}
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <>
                                        <p className="text-gray-700 text-lg flex-grow">{note.content}</p>
                                        <div className="flex gap-2 mt-4 md:mt-0 md:ml-4">
                                            <button
                                                onClick={() => startEditing(note)}
                                                className="bg-yellow-500 text-white py-2 px-4 rounded-lg hover:bg-yellow-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                disabled={loading}
                                            >
                                                Edit
                                            </button>
                                            <button
                                                onClick={() => handleDeleteNote(note.id)}
                                                className="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                disabled={loading}
                                            >
                                                Delete
                                            </button>
                                        </div>
                                    </>
                                )}
                            </li>
                        )) : (
                            <li className="text-center text-gray-500 p-8 rounded-xl bg-white shadow-sm">
                                No notes yet. Add your first note!
                            </li>
                        )}
                    </ul>
                </div>
            );
        }

        const domNode = document.getElementById('root');
        const root = ReactDOM.createRoot(domNode);
        root.render(<App />);
    </script>
</body>
</html>
